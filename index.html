<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"/>
    <meta name="theme-color" content="#F5F5F7">
    <title>Study Spark | Ultimate Workspace</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>

    <style>
        :root {
            --bg-body: #F5F5F7;
            --bg-sidebar: #FFFFFF;
            --bg-card: #FFFFFF;
            --bg-glass: rgba(255, 255, 255, 0.75);
            --bg-glass-border: 1px solid rgba(255, 255, 255, 0.6);
            --bg-input: rgba(0, 0, 0, 0.04);
            --bg-hover: rgba(0, 0, 0, 0.03);
            --text-primary: #1D1D1F;
            --text-secondary: #86868B;
            --text-tertiary: #B0B0B5;
            --border-color: rgba(0,0,0,0.06);
            --accent-blue: #0071e3;
            --accent-blue-soft: rgba(0, 113, 227, 0.15);
            --accent-purple: #5e5ce6;
            --accent-green: #34c759;
            --accent-green-soft: rgba(52, 199, 89, 0.15);
            --accent-orange: #ff9f0a;
            --accent-red: #ff3b30;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.04);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 40px rgba(0, 0, 0, 0.12);
            --shadow-glass: 0 8px 32px rgba(0, 0, 0, 0.05);
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --sidebar-width: 400px;
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.275);
            --ease-smooth: cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        body.dark-mode {
            --bg-body: #050505; 
            --bg-sidebar: #121212;
            --bg-card: #18181A;
            --bg-glass: rgba(20, 20, 20, 0.85);
            --bg-glass-border: 1px solid rgba(255, 255, 255, 0.15);
            --bg-input: #262626;
            --bg-hover: #333333;
            --text-primary: #FFFFFF;
            --text-secondary: #E5E5E5;
            --text-tertiary: #A0A0A0;
            --border-color: #333333;
            --accent-blue: #409CFF;
            --accent-blue-soft: rgba(64, 156, 255, 0.25);
            --accent-purple: #BF5AF2;
            --accent-green: #30D158;
            --accent-green-soft: rgba(48, 209, 88, 0.25);
            --accent-orange: #FF9F0A;
            --accent-red: #FF453A;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, 0.5);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.7);
        }

        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        html, body {
            margin: 0; padding: 0;
            width: 100%; height: 100%;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            transition: background-color 0.3s ease, color 0.3s ease;
            overflow: hidden;
        }

        input, button, textarea { font-family: inherit; }
        ul, li { list-style: none; padding: 0; margin: 0; }
        h1, h2, h3, h4, h5, h6, p { margin: 0; }

        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--text-tertiary); border-radius: 10px; }

        .text-h1 { font-size: 2.5rem; font-weight: 800; letter-spacing: -0.03em; line-height: 1.1; }
        .text-h2 { font-size: 1.5rem; font-weight: 700; letter-spacing: -0.02em; }
        .text-h3 { font-size: 1.2rem; font-weight: 600; letter-spacing: -0.01em; }
        .text-body { font-size: 1rem; line-height: 1.5; color: var(--text-secondary); }
        .text-xs { font-size: 0.75rem; font-weight: 700; letter-spacing: 0.05em; text-transform: uppercase; }

        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes expandHeight { from { max-height: 0; opacity: 0; } to { max-height: 600px; opacity: 1; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-in { animation: fadeInUp 0.5s var(--ease-spring) forwards; }
        .animate-spin { animation: spin 1s linear infinite; }

        .app-layout {
            display: grid;
            grid-template-columns: var(--sidebar-width) 1fr;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            transition: grid-template-columns 0.4s var(--ease-spring);
        }
        .app-layout.collapsed { grid-template-columns: 0px 1fr; }

        .sidebar {
            background: var(--bg-sidebar);
            border-right: 1px solid var(--border-color);
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 32px;
            z-index: 50;
            transition: transform 0.4s var(--ease-spring), opacity 0.3s;
            position: relative;
            overflow: hidden;
        }

        .task-input-container {
            background: var(--bg-body);
            border-radius: var(--radius-md);
            padding: 16px;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
        }

        .task-main-input { width: 100%; border: none; background: transparent; font-size: 1rem; color: var(--text-primary); margin-bottom: 12px; }
        
        .color-dot { width: 24px; height: 24px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        .color-dot.active { transform: scale(1.25); border-color: var(--text-primary); }

        .task-item {
            display: flex; align-items: center; gap: 12px;
            background: var(--bg-card);
            padding: 16px; margin-bottom: 12px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .checkbox {
            width: 22px; height: 22px; border-radius: 50%;
            border: 2px solid var(--text-tertiary);
            display: flex; align-items: center; justify-content: center;
            cursor: pointer; flex-shrink: 0; color: white;
        }
        .checkbox.checked { background: var(--accent-green); border-color: var(--accent-green); }

        .main-content { background: var(--bg-body); overflow-y: auto; padding: 48px 64px; }

        .focus-hero {
            background: var(--bg-glass);
            backdrop-filter: blur(40px);
            border: var(--bg-glass-border);
            border-radius: var(--radius-lg);
            padding: 40px; margin-bottom: 32px;
            text-align: center; min-height: 220px;
        }

        .bento-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 24px; margin-bottom: 48px; }
        .bento-card { background: var(--bg-sidebar); border-radius: var(--radius-lg); padding: 24px; border: 1px solid var(--border-color); }

        .course-card {
            background: var(--bg-card);
            border-radius: var(--radius-md);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
            overflow: hidden;
            position: relative;
        }
        .course-card.open .course-body { display: block; }
        .course-body { display: none; background: var(--bg-body); border-top: 1px solid var(--border-color); animation: expandHeight 0.4s ease forwards; }

        .goal-item { display: flex; align-items: flex-start; gap: 16px; padding: 10px 12px; position: relative; }
        .goal-main-input { font-size: 1rem; font-weight: 600; border: none; background: transparent; width: 100%; color: var(--text-primary); }

        .modal-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px);
            z-index: 200; display: flex; align-items: center; justify-content: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s;
        }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal { background: var(--bg-card); width: 400px; padding: 32px; border-radius: var(--radius-lg); }

        .btn-primary { background: var(--text-primary); color: var(--bg-body); padding: 12px 24px; border-radius: 12px; font-weight: 600; cursor: pointer; border: none; }
        .btn-ghost { background: transparent; color: var(--text-secondary); padding: 8px 16px; border-radius: 8px; cursor: pointer; border: none; }
        .hidden { display: none !important; }

        #toast {
            position: fixed; bottom: 32px; left: 50%; transform: translateX(-50%) translateY(100px);
            background: var(--text-primary); color: var(--bg-body);
            padding: 12px 24px; border-radius: 50px; z-index: 300; transition: transform 0.4s var(--ease-spring);
        }
        #toast.active { transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>

    <div id="loader" style="position:fixed; inset:0; background:var(--bg-body); z-index:999; display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div class="animate-spin" style="width:50px; height:50px; border:4px solid var(--bg-input); border-top-color:var(--accent-blue); border-radius:50%;"></div>
        <h3 style="margin-top:20px; font-weight:600;">Igniting Spark...</h3>
    </div>

    <div id="toast">
        <span id="toastMsg">Action Completed</span>
        <button id="toastUndo" style="background:rgba(255,255,255,0.2); border:none; color:white; padding:4px 8px; border-radius:4px; cursor:pointer; margin-left:10px;">UNDO</button>
    </div>

    <div class="app-layout" id="appLayout">
        <aside class="sidebar" id="sidebar">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
                <h2 class="text-h2">Tasks</h2>
                <button class="btn-ghost" id="btnRandomTask">Pick Random</button>
            </div>

            <div class="task-input-container">
                <form id="addTaskForm">
                    <input type="text" id="taskInput" class="task-main-input" placeholder="What needs focusing?" autocomplete="off">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <input type="number" id="taskDays" style="width:60px; background:var(--bg-input); border:none; border-radius:4px; padding:4px;" placeholder="Days">
                        <button type="submit" class="btn-primary">Add</button>
                    </div>
                    <div style="display:flex; gap:8px; margin-top:12px;">
                        <div class="color-dot active" style="background: var(--accent-blue);" data-color="blue"></div>
                        <div class="color-dot" style="background: var(--accent-purple);" data-color="purple"></div>
                        <div class="color-dot" style="background: var(--accent-green);" data-color="green"></div>
                    </div>
                </form>
            </div>

            <div id="taskList"></div>
            <div id="emptyState" class="hidden" style="text-align:center; opacity:0.5; padding:20px;">All caught up!</div>

            <div style="margin-top:auto; padding-top:20px; border-top:1px solid var(--border-color); text-align:center;">
                <button class="btn-ghost" id="themeToggle">◐ Switch Theme</button>
            </div>
        </aside>

        <main class="main-content">
            <header style="display:flex; justify-content:space-between; margin-bottom:48px;">
                <div style="display:flex; align-items:center; gap:20px;">
                    <button id="sidebarToggle" class="btn-ghost" style="border:1px solid var(--border-color)">☰</button>
                    <div>
                        <p class="text-xs" id="currentDate"></p>
                        <h1 class="text-h1" id="greeting">Welcome</h1>
                    </div>
                </div>
                <button class="auth-btn btn-primary" id="loginBtn">Sign In</button>
            </header>

            <section class="focus-hero" id="focusHero"></section>

            <div class="bento-grid">
                <div class="bento-card">
                    <p class="text-xs">TIMER</p>
                    <div id="timerDisplay" style="font-size:3rem; font-weight:800; text-align:center; margin:20px 0;">25:00</div>
                    <div style="display:flex; gap:10px; justify-content:center;">
                        <button id="startTimerBtn" class="btn-primary">Start</button>
                        <button id="resetTimerBtn" class="btn-ghost">Reset</button>
                    </div>
                </div>
                <div class="bento-card">
                    <p class="text-xs">MOMENTUM</p>
                    <h1 class="text-h1" id="progressPercent">0%</h1>
                    <div style="width:100%; height:8px; background:var(--bg-input); border-radius:10px; margin:15px 0;">
                        <div id="progressBar" style="width:0%; height:100%; background:var(--accent-green); transition:0.5s;"></div>
                    </div>
                    <p id="progressText" class="text-body">0/0 Tasks</p>
                </div>
            </div>

            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
                <h2 class="text-h2">Courses</h2>
                <button class="btn-primary" onclick="addCourse()">+ New Course</button>
            </div>
            <div id="coursesContainer"></div>
            <div id="emptyCourses" class="hidden" style="text-align:center; padding:40px; border:2px dashed var(--bg-input);">No courses yet.</div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCu6cbaEw4BzXvF8rGx94h6WHarEFH9Z-k",
            authDomain: "coursesprogress-5658f.firebaseapp.com",
            projectId: "coursesprogress-5658f",
            storageBucket: "coursesprogress-5658f.firebasestorage.app",
            messagingSenderId: "572695866101",
            appId: "1:572695866101:web:bb6dc8058387358b7773bc"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        let state = {
            user: null,
            todos: [],
            courses: [],
            focusId: null,
            timer: { isRunning: false, timeLeft: 1500, duration: 25 },
            isLocalUpdate: false
        };

        const colors = { blue: '#0071e3', purple: '#5e5ce6', green: '#34c759', orange: '#ff9f0a', red: '#ff3b30' };
        let activeColor = 'blue';
        let focusTarget = null;

        const getEl = (id) => document.getElementById(id);
        const generateId = () => '_' + Math.random().toString(36).substr(2, 9);

        function init() {
            setTimeout(() => getEl('loader').style.display = 'none', 800);
            updateGreeting();
            setupEventListeners();
            if(localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
        }

        function updateGreeting() {
            const now = new Date();
            getEl('currentDate').innerText = now.toDateString().toUpperCase();
            const hr = now.getHours();
            getEl('greeting').innerText = hr < 12 ? 'Good Morning' : hr < 18 ? 'Good Afternoon' : 'Good Evening';
        }

        function setupEventListeners() {
            getEl('sidebarToggle').onclick = () => getEl('appLayout').classList.toggle('collapsed');
            getEl('themeToggle').onclick = () => {
                document.body.classList.toggle('dark-mode');
                localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            };
            getEl('addTaskForm').onsubmit = (e) => {
                e.preventDefault();
                const text = getEl('taskInput').value.trim();
                if(text) addTask(text, parseInt(getEl('taskDays').value) || 0);
            };
            getEl('startTimerBtn').onclick = toggleTimer;
            getEl('resetTimerBtn').onclick = resetTimer;

            document.querySelectorAll('.color-dot').forEach(dot => {
                dot.onclick = () => {
                    document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
                    dot.classList.add('active');
                    activeColor = dot.dataset.color;
                };
            });
        }

        onAuthStateChanged(auth, (user) => {
            state.user = user;
            if (user) {
                getEl('loginBtn').innerText = 'Sign Out';
                getEl('loginBtn').onclick = () => signOut(auth);
                onSnapshot(doc(db, 'users', user.uid), (docSnap) => {
                    if (docSnap.exists()) {
                        if (state.isLocalUpdate) { state.isLocalUpdate = false; return; }
                        const d = docSnap.data();
                        
                        // STABILITY FIX: Sanitize incoming data
                        state.todos = d.todos || [];
                        state.courses = (d.courses || []).map(course => ({
                            ...course,
                            categories: (course.categories || []).map(cat => ({
                                ...cat,
                                goals: cat.goals || [] // Ensure goals array exists
                            }))
                        }));
                        state.focusId = d.focusId || null;
                        renderAll();
                    }
                });
            } else {
                getEl('loginBtn').innerText = 'Sign In';
                getEl('loginBtn').onclick = () => signInWithPopup(auth, provider);
                renderAll();
            }
        });

        function saveData() {
            renderAll();
            if (state.user) {
                state.isLocalUpdate = true;
                setDoc(doc(db, 'users', state.user.uid), {
                    todos: state.todos,
                    courses: state.courses,
                    focusId: state.focusId
                }, { merge: true });
            }
        }

        function renderAll() {
            renderTasks();
            renderFocus();
            renderCourses();
            renderStats();
        }

        function renderTasks() {
            const list = getEl('taskList');
            list.innerHTML = '';
            const active = state.todos.filter(t => !t.completed);
            getEl('emptyState').classList.toggle('hidden', active.length > 0);

            active.forEach(t => {
                const el = document.createElement('div');
                el.className = 'task-item animate-in';
                el.style.borderLeft = `4px solid ${colors[t.color]}`;
                el.innerHTML = `
                    <div class="checkbox"></div>
                    <div style="flex:1">
                        <div>${t.text}</div>
                        <small style="opacity:0.6">${t.days ? t.days + 'd left' : ''}</small>
                    </div>
                `;
                el.querySelector('.checkbox').onclick = () => toggleTask(t.id);
                el.onclick = (e) => { if(e.target.className !== 'checkbox') setFocus(t.id); };
                list.appendChild(el);
            });
        }

        function renderCourses() {
            const container = getEl('coursesContainer');
            container.innerHTML = '';
            getEl('emptyCourses').classList.toggle('hidden', state.courses.length > 0);

            state.courses.forEach(course => {
                // STABILITY FIX: Guard against undefined categories/goals
                const categories = course.categories || [];
                const totalG = categories.reduce((acc, c) => acc + (c.goals ? c.goals.length : 0), 0);
                const doneG = categories.reduce((acc, c) => acc + (c.goals ? c.goals.filter(g => g.completed).length : 0), 0);
                const progress = totalG === 0 ? 0 : (doneG / totalG) * 100;

                const card = document.createElement('div');
                card.className = `course-card ${course.isOpen ? 'open' : ''}`;
                card.innerHTML = `
                    <div style="padding:20px; cursor:pointer; display:flex; justify-content:space-between; align-items:center;">
                        <div>
                            <input class="goal-main-input" value="${course.name}" style="font-size:1.2rem">
                            <div style="font-size:0.7rem; opacity:0.6">${doneG}/${totalG} GOALS DONE</div>
                        </div>
                        <div>${course.isOpen ? '▲' : '▼'}</div>
                    </div>
                    <div class="course-body">
                        ${categories.map(cat => `
                            <div style="padding:15px; border-bottom:1px solid var(--border-color)">
                                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                                    <strong class="text-xs">${cat.name}</strong>
                                    <button onclick="window.addGoal('${course.id}', '${cat.id}')" class="btn-ghost" style="font-size:0.7rem">+ Goal</button>
                                </div>
                                <div>
                                    ${(cat.goals || []).map(goal => `
                                        <div class="goal-item">
                                            <div class="checkbox ${goal.completed ? 'checked' : ''}" onclick="window.toggleGoal('${course.id}', '${cat.id}', '${goal.id}')">${goal.completed ? '✓' : ''}</div>
                                            <input class="goal-main-input" value="${goal.title}" onblur="window.updateGoal('${course.id}', '${cat.id}', '${goal.id}', this.value)">
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                        <div style="padding:10px; text-align:right">
                            <button onclick="window.delCourse('${course.id}')" style="color:red" class="btn-ghost">Delete Course</button>
                        </div>
                    </div>
                `;

                card.firstElementChild.onclick = (e) => {
                    if(e.target.tagName !== 'INPUT') {
                        course.isOpen = !course.isOpen;
                        saveData();
                    }
                };
                card.querySelector('input').onblur = (e) => {
                    course.name = e.target.value;
                    saveData();
                };

                container.appendChild(card);
            });
        }

        function renderFocus() {
            const hero = getEl('focusHero');
            const task = state.todos.find(t => t.id === state.focusId && !t.completed);
            if(!task) {
                hero.innerHTML = `<h2>No Active Focus</h2><p>Select a task to begin.</p>`;
                return;
            }
            hero.innerHTML = `
                <p class="text-xs" style="color:${colors[task.color]}">Current Priority</p>
                <h1 class="text-h1">${task.text}</h1>
                <button class="btn-primary" style="margin-top:20px" id="completeFocusBtn">Complete Task</button>
            `;
            getEl('completeFocusBtn').onclick = () => {
                confetti();
                toggleTask(task.id);
            };
        }

        function renderStats() {
            const total = state.todos.length;
            const done = state.todos.filter(t => t.completed).length;
            const pct = total === 0 ? 0 : Math.round((done/total)*100);
            getEl('progressPercent').innerText = pct + '%';
            getEl('progressBar').style.width = pct + '%';
            getEl('progressText').innerText = `${done}/${total} Tasks`;
        }

        function addTask(text, days) {
            state.todos.push({ id: generateId(), text, days, color: activeColor, completed: false });
            getEl('taskInput').value = '';
            saveData();
        }

        function toggleTask(id) {
            const t = state.todos.find(x => x.id === id);
            if(t) { t.completed = !t.completed; saveData(); }
        }

        window.addCourse = () => {
            state.courses.push({
                id: generateId(), name: 'New Course', isOpen: true,
                categories: [{ id: generateId(), name: 'General', goals: [] }]
            });
            saveData();
        };

        window.delCourse = (id) => {
            if(confirm("Delete course?")) {
                state.courses = state.courses.filter(c => c.id !== id);
                saveData();
            }
        };

        window.addGoal = (cid, catId) => {
            const course = state.courses.find(c => c.id === cid);
            const cat = course.categories.find(ca => ca.id === catId);
            cat.goals.push({ id: generateId(), title: 'New Goal', completed: false });
            saveData();
        };

        window.toggleGoal = (cid, catId, gid) => {
            const course = state.courses.find(c => c.id === cid);
            const cat = course.categories.find(ca => ca.id === catId);
            const goal = cat.goals.find(g => g.id === gid);
            goal.completed = !goal.completed;
            saveData();
        };

        window.updateGoal = (cid, catId, gid, val) => {
            const course = state.courses.find(c => c.id === cid);
            const cat = course.categories.find(ca => ca.id === catId);
            const goal = cat.goals.find(g => g.id === gid);
            goal.title = val;
            saveData();
        };

        function setFocus(id) { state.focusId = id; saveData(); }

        let timerInt;
        function toggleTimer() {
            if(state.timer.isRunning) {
                clearInterval(timerInt);
                state.timer.isRunning = false;
                getEl('startTimerBtn').innerText = 'Resume';
            } else {
                state.timer.isRunning = true;
                getEl('startTimerBtn').innerText = 'Pause';
                timerInt = setInterval(() => {
                    if(state.timer.timeLeft > 0) {
                        state.timer.timeLeft--;
                        const m = Math.floor(state.timer.timeLeft / 60);
                        const s = state.timer.timeLeft % 60;
                        getEl('timerDisplay').innerText = `${m}:${s.toString().padStart(2, '0')}`;
                    } else {
                        clearInterval(timerInt);
                        alert("Session complete!");
                        resetTimer();
                    }
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerInt);
            state.timer.isRunning = false;
            state.timer.timeLeft = 25 * 60;
            getEl('timerDisplay').innerText = "25:00";
            getEl('startTimerBtn').innerText = 'Start';
        }

        init();
    </script>
</body>
</html>
