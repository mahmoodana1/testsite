<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Study Spark</title>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <style>
    :root {
      /* Apple-style Palette (Light Mode) */
      --bg-body: #F5F5F7; /* Apple Off-White */
      --card-bg: rgba(255, 255, 255, 0.65); /* Translucent */
      --card-solid: #FFFFFF;
      --text-primary: #1D1D1F; /* Almost Black */
      --text-secondary: #86868B;
      
      /* Accents (Solid, No Gradients) */
      --accent-blue: #007AFF;
      --accent-purple: #5856D6;
      --accent-green: #34C759;
      --accent-orange: #FF9500;
      --accent-red: #FF3B30;
      
      /* Glassmorphism */
      --blur: 30px;
      --border: 1px solid rgba(0, 0, 0, 0.05);
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.04);
      --radius: 24px;
    }

    body.dark-mode {
      /* Apple-style Palette (Dark Mode) */
      --bg-body: #000000;
      --card-bg: rgba(28, 28, 30, 0.65);
      --card-solid: #1C1C1E;
      --text-primary: #F5F5F7;
      --text-secondary: #86868B;
      --border: 1px solid rgba(255, 255, 255, 0.1);
      --shadow: 0 4px 24px rgba(0, 0, 0, 0.2);
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; user-select: none; }
    
    body {
      margin: 0;
      /* System Fonts Stack (San Francisco, Segoe UI, Roboto) */
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: var(--bg-body);
      color: var(--text-primary);
      transition: background 0.4s ease;
      min-height: 100vh;
      overflow-x: hidden;
      padding-bottom: 80px;
    }

    /* --- Animations --- */
    @keyframes scaleIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .animate-in { animation: scaleIn 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

    /* --- Layout --- */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 1fr;
      gap: 20px;
    }

    /* PC Layout: Sidebar on Left, Content on Right */
    @media (min-width: 900px) {
      .container {
        grid-template-columns: 350px 1fr; /* Fixed Sidebar, Flexible Content */
        align-items: start;
        padding: 40px;
      }
      /* Hide Mobile FAB on PC */
      .fab { display: none !important; }
      /* Sidebar is always visible on PC */
      .sidebar {
        position: sticky !important;
        top: 40px;
        transform: none !important;
        width: 100% !important;
        height: calc(100vh - 80px) !important;
        box-shadow: none !important;
        background: var(--card-bg) !important;
        border: var(--border) !important;
        border-radius: var(--radius) !important;
        z-index: 1 !important;
      }
      .sidebar-overlay { display: none !important; }
      #sidebarClose { display: none; }
    }

    /* --- Cards (The "Glass" Look) --- */
    .glass-panel {
      background: var(--card-bg);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      border: var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 24px;
      transition: transform 0.2s;
    }
    
    .glass-panel:hover {
      transform: translateY(-2px); /* Lively hover effect */
    }

    /* --- Typography --- */
    h1 { font-size: 2.5rem; font-weight: 700; letter-spacing: -0.02em; margin: 0; }
    h2 { font-size: 1.2rem; font-weight: 600; margin: 0 0 16px 0; letter-spacing: -0.01em; }
    h3 { font-size: 1rem; font-weight: 600; margin: 0; }
    .subtitle { color: var(--text-secondary); font-size: 0.9rem; margin-top: 4px; font-weight: 500; }

    /* --- Buttons --- */
    .btn {
      border: none;
      background: var(--text-primary);
      color: var(--bg-body);
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.1s;
      display: inline-flex; align-items: center; justify-content: center; gap: 8px;
    }
    .btn:active { transform: scale(0.96); }
    .btn:hover { opacity: 0.8; }
    
    .btn-ghost { background: transparent; color: var(--text-secondary); border: 1px solid rgba(128,128,128,0.2); }
    .btn-ghost:hover { background: rgba(128,128,128,0.1); color: var(--text-primary); }
    
    .btn-icon { width: 36px; height: 36px; padding: 0; border-radius: 50%; }

    /* --- Inputs --- */
    .input-group {
      background: rgba(128,128,128,0.08);
      border-radius: 14px;
      padding: 4px;
      display: flex;
      align-items: center;
      border: 1px solid transparent;
      transition: background 0.2s, border-color 0.2s;
    }
    .input-group:focus-within { background: var(--bg-body); border-color: var(--accent-blue); }
    
    .input-clean {
      background: transparent; border: none; padding: 10px; font-size: 1rem;
      color: var(--text-primary); font-family: inherit; width: 100%;
    }
    
    /* Date Picker Styling */
    input[type="date"] {
        border: none; background: transparent; color: var(--text-secondary);
        font-family: inherit; font-size: 0.85rem; padding: 0 8px; cursor: pointer;
    }
    
    /* --- Specific Components --- */

    /* 1. Sidebar Task List */
    .sidebar {
      position: fixed; inset: 0; z-index: 1000;
      background: var(--bg-body);
      transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.32, 0.72, 0, 1);
      display: flex; flex-direction: column; padding: 24px;
    }
    .sidebar.open { transform: translateY(0); }
    
    .task-item {
      background: var(--card-solid);
      padding: 16px; border-radius: 16px; margin-bottom: 10px;
      display: flex; align-items: center; gap: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.02);
      border: var(--border);
    }
    
    /* Custom Checkbox */
    .check-circle {
      width: 24px; height: 24px; border-radius: 50%;
      border: 2px solid var(--text-secondary);
      cursor: pointer; display: flex; align-items: center; justify-content: center;
      transition: all 0.2s;
    }
    .check-circle.checked {
      background: var(--accent-green); border-color: var(--accent-green);
      color: white; font-size: 14px;
    }

    /* 2. Current Focus Card (Hero) */
    .focus-card {
      min-height: 250px;
      display: flex; flex-direction: column; justify-content: space-between;
      position: relative; overflow: hidden;
      background: var(--card-solid);
    }
    /* Accent Bar on the left */
    .focus-card::before {
      content: ''; position: absolute; left: 0; top: 0; bottom: 0; width: 6px;
      background: var(--accent-blue);
    }
    .focus-label { text-transform: uppercase; font-size: 0.75rem; letter-spacing: 2px; color: var(--accent-blue); font-weight: 700; margin-bottom: 12px; }
    .focus-title { font-size: 2.2rem; line-height: 1.1; font-weight: 700; }
    
    /* 3. Pomodoro */
    .pomodoro-section { text-align: center; }
    .timer-large { font-size: 4rem; font-weight: 700; font-variant-numeric: tabular-nums; letter-spacing: -2px; margin: 10px 0; }
    
    /* 4. Courses */
    .course-row {
      display: flex; align-items: center; justify-content: space-between;
      padding: 16px; border-bottom: 1px solid rgba(128,128,128,0.1);
      cursor: pointer;
    }
    .course-row:last-child { border-bottom: none; }
    .progress-pill {
      background: rgba(128,128,128,0.1); color: var(--text-primary);
      padding: 4px 10px; border-radius: 20px; font-size: 0.8rem; font-weight: 600;
    }

    /* --- Utilities --- */
    .fab {
      position: fixed; bottom: 24px; right: 24px;
      width: 60px; height: 60px; border-radius: 30px;
      background: var(--text-primary); color: var(--bg-body);
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      border: none; font-size: 24px; cursor: pointer; z-index: 900;
    }
    .hidden { display: none !important; }
    
    /* Profile in Header */
    .profile-pill {
        background: rgba(128,128,128,0.1); padding: 4px 12px 4px 4px;
        border-radius: 50px; display: flex; align-items: center; gap: 8px;
        font-size: 0.9rem; font-weight: 500;
    }

    /* Color Dots */
    .color-dot { width: 20px; height: 20px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
    .color-dot.selected { transform: scale(1.2); border-color: var(--text-primary); }

  </style>
</head>
<body>

  <div id="authOverlay" style="position:fixed; inset:0; background:var(--bg-body); z-index:2000; display:flex; align-items:center; justify-content:center;">
     <h3>Loading Workspace...</h3>
  </div>

  <div class="container">
    
    <aside id="sidebar" class="sidebar">
       <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
          <h2>Tasks</h2>
          <button class="btn btn-ghost btn-icon" id="sidebarClose" style="display:block;">‚úï</button>
       </div>

       <form id="addTodoForm" style="margin-bottom: 24px;">
          <div class="input-group">
              <input type="text" id="todoInput" class="input-clean" placeholder="Add a new task..." required>
              <input type="date" id="todoDate">
          </div>
          
          <div style="display:flex; gap:10px; margin-top:12px; align-items:center;">
             <div class="color-dot" style="background:var(--accent-blue)" onclick="setColor('blue', this)"></div>
             <div class="color-dot" style="background:var(--accent-purple)" onclick="setColor('purple', this)"></div>
             <div class="color-dot" style="background:var(--accent-orange)" onclick="setColor('orange', this)"></div>
             <div class="color-dot" style="background:var(--accent-red)" onclick="setColor('red', this)"></div>
             <div style="flex:1"></div>
             <button type="submit" class="btn btn-sm">Add</button>
          </div>
       </form>

       <div id="todoList" style="overflow-y:auto; flex:1; padding-bottom:20px;">
          </div>
    </aside>

    <main style="display: flex; flex-direction: column; gap: 24px;">
       
       <header style="display:flex; justify-content:space-between; align-items:center;">
          <div>
              <div class="subtitle" id="currentDate">Friday, October 24</div>
              <h1 id="greeting">Hello</h1>
          </div>
          <div id="authContainer">
             <button id="loginBtn" class="btn">Sign In</button>
          </div>
       </header>

       <div id="mainContent" class="hidden" style="display: flex; flex-direction: column; gap: 24px;">

           <section id="focusSection" class="glass-panel focus-card animate-in">
               </section>

           <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;">
               
               <div class="glass-panel pomodoro-section">
                   <div style="display:flex; justify-content:space-between; width:100%; margin-bottom:10px;">
                       <span style="font-weight:700; color:var(--accent-purple); font-size:0.8rem; letter-spacing:1px;">TIMER</span>
                       <button class="btn btn-ghost btn-icon" style="width:24px; height:24px;" onclick="toggleSettings()">‚öôÔ∏è</button>
                   </div>
                   
                   <div class="timer-large" id="timerDisplay">25:00</div>
                   
                   <div id="timerControls" style="display:flex; gap:12px; justify-content:center;">
                       <button id="startTimer" class="btn" style="background:var(--bg-body); color:var(--text-primary);">Start</button>
                       <button id="resetTimer" class="btn btn-ghost">Reset</button>
                   </div>
                   
                   <div id="timerSettings" class="hidden" style="margin-top:10px;">
                       <input type="number" id="workDur" value="25" style="width:50px; border:1px solid #ccc; border-radius:8px; padding:4px;"> min
                   </div>
               </div>

               <div class="glass-panel" style="padding:0; overflow:hidden; display:flex; flex-direction:column;">
                   <div style="padding:24px 24px 10px 24px; display:flex; justify-content:space-between; align-items:center;">
                       <h3>Courses</h3>
                       <button class="btn btn-ghost btn-icon" style="width:28px; height:28px;" onclick="addCourse()">+</button>
                   </div>
                   <div id="coursesList" style="overflow-y:auto; flex:1;">
                       </div>
               </div>

           </div>
           
           <div style="text-align:center;">
               <button id="themeToggle" class="btn btn-ghost">Switch Appearance</button>
           </div>
       </div>

       <div id="loginPrompt" class="glass-panel hidden" style="text-align:center; padding: 40px;">
           <h2>Get Started</h2>
           <p class="subtitle">Sign in to sync your tasks.</p>
       </div>

    </main>
  </div>

  <button id="fab" class="fab">Ôºã</button>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

    // ===========================================
    // üî¥ PASTE FIREBASE CONFIG HERE üî¥
    // ===========================================
 const firebaseConfig = {
  apiKey: "AIzaSyCu6cbaEw4BzXvF8rGx94h6WHarEFH9Z-k",
  authDomain: "coursesprogress-5658f.firebaseapp.com",
  projectId: "coursesprogress-5658f",
  storageBucket: "coursesprogress-5658f.firebasestorage.app",
  messagingSenderId: "572695866101",
  appId: "1:572695866101:web:bb6dc8058387358b7773bc",
  measurementId: "G-XD8W9V1XPE"
};


    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GoogleAuthProvider();

    // State
    let currentUser = null;
    let todos = [], courses = [], currentTaskId = null;
    let selectedColor = 'blue';

    // --- UI Init ---
    const updateDate = () => {
        const d = new Date();
        document.getElementById('currentDate').textContent = d.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
        const h = d.getHours();
        document.getElementById('greeting').textContent = h < 12 ? 'Good Morning' : h < 18 ? 'Good Afternoon' : 'Good Evening';
    };
    updateDate();

    // --- Auth ---
    onAuthStateChanged(auth, (user) => {
        document.getElementById('authOverlay').style.display = 'none';
        if (user) {
            currentUser = user;
            document.getElementById('authContainer').innerHTML = `
                <div class="profile-pill">
                    <img src="${user.photoURL}" style="width:24px; height:24px; border-radius:50%;">
                    <span onclick="window.location.reload()" style="cursor:pointer">Sign Out</span>
                </div>`;
            document.getElementById('mainContent').classList.remove('hidden');
            document.getElementById('loginPrompt').classList.add('hidden');
            
            // Sync
            onSnapshot(doc(db, "users", user.uid), (snap) => {
                if (snap.exists()) {
                    const data = snap.data();
                    todos = data.todos || [];
                    courses = data.courses || [];
                    currentTaskId = data.currentTaskId;
                    renderAll();
                } else saveData();
            });
        } else {
            document.getElementById('mainContent').classList.add('hidden');
            document.getElementById('loginPrompt').classList.remove('hidden');
            document.getElementById('loginBtn').onclick = () => signInWithPopup(auth, provider);
        }
    });

    async function saveData() {
        if(!currentUser) return;
        await setDoc(doc(db, "users", currentUser.uid), { todos, courses, currentTaskId }, { merge: true });
    }

    // --- Rendering ---
    function renderAll() {
        renderTodos();
        renderFocus();
        renderCourses();
    }

    // 1. Task List
    function renderTodos() {
        const list = document.getElementById('todoList');
        if(!todos.length) { list.innerHTML = `<div style="text-align:center; color:var(--text-secondary); padding:20px;">No tasks yet.</div>`; return; }

        list.innerHTML = todos.map(t => {
            // Determine accent color for checkbox
            const colorMap = { blue:'#007AFF', purple:'#5856D6', orange:'#FF9500', red:'#FF3B30' };
            const c = colorMap[t.color] || '#007AFF';
            
            return `
            <div class="task-item" style="border-left: 4px solid ${c}">
                <div class="check-circle ${t.completed?'checked':''}" 
                     style="${t.completed?`background:${c}; border-color:${c}`:''}"
                     onclick="window.toggleTodo('${t.id}')">
                     ${t.completed ? '‚úì' : ''}
                </div>
                <div style="flex:1;">
                    <div style="font-weight:600; ${t.completed?'text-decoration:line-through; color:var(--text-secondary)':''}">${t.text}</div>
                    ${t.dueDate ? `<div style="font-size:0.8rem; color:var(--text-secondary);">Due ${new Date(t.dueDate).toLocaleDateString()}</div>` : ''}
                </div>
                <button class="btn btn-ghost btn-icon" onclick="window.setFocus('${t.id}')" title="Set Focus">üéØ</button>
                <button class="btn btn-ghost btn-icon" onclick="window.deleteTodo('${t.id}')" style="color:var(--text-secondary);">‚úï</button>
            </div>`;
        }).join('');
    }

    // 2. Current Focus
    function renderFocus() {
        const section = document.getElementById('focusSection');
        const t = todos.find(x => x.id === currentTaskId);
        
        if (!t || t.completed) {
            section.innerHTML = `
                <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; opacity:0.6;">
                    <h3>No Active Focus</h3>
                    <p>Select a task from the list or add a new one.</p>
                </div>
            `;
            // Remove colored border if no task
            section.style.setProperty('--accent-blue', '#86868B');
        } else {
            const colorMap = { blue:'#007AFF', purple:'#5856D6', orange:'#FF9500', red:'#FF3B30' };
            const c = colorMap[t.color] || '#007AFF';
            
            // Dynamic Accent Color for the Hero Card
            const style = document.createElement('style');
            style.innerHTML = `.focus-card::before { background: ${c} !important; } .focus-label { color: ${c} !important; }`;
            section.appendChild(style);

            section.innerHTML = `
                <div>
                    <div class="focus-label">Current Focus</div>
                    <div class="focus-title">${t.text}</div>
                    ${t.dueDate ? `<div class="subtitle">Due ${new Date(t.dueDate).toLocaleDateString()}</div>` : ''}
                </div>
                <div style="margin-top:20px; text-align:right;">
                    <button class="btn" style="background:${c}; color:white;" onclick="window.toggleTodo('${t.id}')">Mark Complete</button>
                </div>
            `;
        }
    }

    // 3. Courses
    function renderCourses() {
        const list = document.getElementById('coursesList');
        if(!courses.length) { list.innerHTML=`<div style="padding:20px; text-align:center; color:var(--text-secondary)">No courses added.</div>`; return; }
        
        list.innerHTML = courses.map(c => `
            <div class="course-row" onclick="alert('Course detail view would open here!')">
                <span style="font-weight:600;">${c.name}</span>
                <span class="progress-pill">${c.lectures?.length || 0} Lectures</span>
            </div>
        `).join('');
    }

    // --- Logic ---
    window.setColor = (c, el) => {
        document.querySelectorAll('.color-dot').forEach(d=>d.style.transform='scale(1)');
        el.style.transform = 'scale(1.3)';
        selectedColor = c;
    }

    document.getElementById('addTodoForm').onsubmit = (e) => {
        e.preventDefault();
        const txt = document.getElementById('todoInput').value.trim();
        const date = document.getElementById('todoDate').value;
        if(txt) {
            todos.unshift({ id: Date.now().toString(), text: txt, completed: false, color: selectedColor, dueDate: date || null });
            document.getElementById('todoInput').value='';
            if(!currentTaskId) currentTaskId = todos[0].id;
            saveData();
        }
    }

    window.toggleTodo = (id) => {
        const t = todos.find(x=>x.id===id);
        t.completed = !t.completed;
        if(t.completed) {
            confetti({ particleCount: 80, spread: 60, origin: { y: 0.6 } });
            if(currentTaskId === id) currentTaskId = null;
        }
        saveData();
    }

    window.setFocus = (id) => { currentTaskId = id; saveData(); }
    window.deleteTodo = (id) => { todos = todos.filter(x=>x.id!==id); saveData(); }
    
    window.addCourse = () => {
        const n = prompt("Course Name:");
        if(n) { courses.push({id:Date.now().toString(), name:n, lectures:[]}); saveData(); }
    }

    // --- Sidebar (Mobile) ---
    const sidebar = document.getElementById('sidebar');
    const fab = document.getElementById('fab');
    const closeBtn = document.getElementById('sidebarClose');
    
    fab.onclick = () => sidebar.classList.add('open');
    closeBtn.onclick = () => sidebar.classList.remove('open');

    // --- Sortable ---
    new Sortable(document.getElementById('todoList'), { animation: 150, delay: 100, onEnd: (evt) => {
        const item = todos.splice(evt.oldIndex, 1)[0];
        todos.splice(evt.newIndex, 0, item);
        saveData();
    }});

    // --- Theme & Pomodoro ---
    document.getElementById('themeToggle').onclick = () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode')?'dark':'light');
    }
    if(localStorage.getItem('theme')==='dark') document.body.classList.add('dark-mode');

    let timer, timeLeft, isRunning=false;
    window.toggleSettings = () => document.getElementById('timerSettings').classList.toggle('hidden');
    document.getElementById('startTimer').onclick = function() {
        if(isRunning) { clearInterval(timer); isRunning=false; this.textContent="Start"; }
        else {
            if(!timeLeft) timeLeft=document.getElementById('workDur').value*60;
            isRunning=true; this.textContent="Pause";
            timer = setInterval(() => {
                if(timeLeft>0) {
                    timeLeft--;
                    const m=Math.floor(timeLeft/60).toString().padStart(2,'0');
                    const s=(timeLeft%60).toString().padStart(2,'0');
                    document.getElementById('timerDisplay').innerText=`${m}:${s}`;
                } else { clearInterval(timer); alert("Done!"); isRunning=false; }
            }, 1000);
        }
    }
    document.getElementById('resetTimer').onclick = () => {
        clearInterval(timer); isRunning=false; timeLeft=document.getElementById('workDur').value*60;
        document.getElementById('timerDisplay').innerText=`${Math.floor(timeLeft/60)}:00`;
        document.getElementById('startTimer').textContent="Start";
    }

  </script>
</body>
</html>
